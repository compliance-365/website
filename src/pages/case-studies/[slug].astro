---
import Base from '../../layouts/BaseLayout.astro';

// Tell Astro which slugs exist at build time
export async function getStaticPaths() {
  const entries = await Astro.glob('../../../content/case-studies/*.md');

  // If no case studies exist, still return an empty array so build succeeds
  if (!entries.length) return [];

  return entries.map((entry) => {
    // Extract slug from the file path
    const parts = entry.file.split('/');
    const filename = parts[parts.length - 1]; // e.g. health-saas.md
    const slug = filename.replace(/\.md$/, ''); // strip .md extension

    return {
      params: { slug }, // required for build
      props: { entry }
    };
  });
}

// Props will contain the Markdown entry we matched
const { entry } = Astro.props;
const title = entry?.frontmatter?.title ?? 'Case Study';
const summary = entry?.frontmatter?.summary ?? '';
---
<Base title={`${title} — Case Study`}>
  <section style="max-width:1100px;margin:0 auto;padding:36px 20px;">
    <a href="/case-studies" style="text-decoration:none">← Back to Case Studies</a>
    <h1 style="font-size:2rem;margin:8px 0 12px">{title}</h1>
    {summary && <p style="opacity:.75;margin:0 0 12px">{summary}</p>}
    {entry ? <entry.Content /> : <p>Coming soon.</p>}
  </section>
</Base>
