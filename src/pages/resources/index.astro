---
import Base from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
const base = import.meta.env.BASE_URL || '/';
---
<Base title="Resources — Compliance365" description="Checklists, guides and webinars to help you move faster.">
  <Header />

  <section class="container section">
    <h1>Resources</h1>
    <p class="muted" style="max-width:760px">Quick wins to help you get audit-ready faster. Light lead capture, instant access.</p>

    <div class="grid-3" style="margin-top:16px">
      <!-- Checklists -->
      <a class="card lift" href={`${base}checklist/iso27001`} style="color:inherit" aria-label="ISO 27001 checklist">
        <h3>ISO 27001 Readiness Checklist</h3>
        <p class="muted">Scope, risk, SoA & internal audit.</p>
        <span class="pill">Start →</span>
      </a>
      <a class="card lift" href={`${base}checklist/iso27701`} style="color:inherit" aria-label="ISO 27701 checklist">
        <h3>ISO 27701 Readiness Checklist</h3>
        <p class="muted">PIMS, DPIA, ROPA, subject rights.</p>
        <span class="pill">Start →</span>
      </a>
      <a class="card lift" href={`${base}checklist/iso42001`} style="color:inherit" aria-label="ISO 42001 checklist">
        <h3>ISO 42001 Readiness Checklist</h3>
        <p class="muted">AIMS, AI risk, oversight & monitoring.</p>
        <span class="pill">Start →</span>
      </a>

      <!-- Example gated downloads (Formspree modal trigger) -->
      <button class="card lift" style="text-align:left;cursor:pointer" data-open-download="whitepaper-ai">
        <h3>Guide: Practical AI Governance</h3>
        <p class="muted">How to prepare for ISO 42001 & the EU AI Act.</p>
        <span class="pill">Download PDF →</span>
      </button>
      <button class="card lift" style="text-align:left;cursor:pointer" data-open-download="webinar-e8">
        <h3>Webinar: Essential Eight in M365</h3>
        <p class="muted">Practical pathways to maturity uplift.</p>
        <span class="pill">Watch on-demand →</span>
      </button>
      <button class="card lift" style="text-align:left;cursor:pointer" data-open-download="guide-soc2">
        <h3>Guide: SOC 2 for SaaS</h3>
        <p class="muted">Map TSC to your stack and evidence flows.</p>
        <span class="pill">Download PDF →</span>
      </button>
    </div>
  </section>

  <Footer />

  <!-- Lightweight lead capture modal shared by buttons above -->
  <div id="resModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:2000;">
    <div style="background:#fff; padding:24px; border-radius:14px; max-width:420px; width:100%; box-shadow:0 12px 30px rgba(0,0,0,.2)">
      <h3 style="margin-top:0">Get the resource</h3>
      <p class="muted small">Enter your details for instant access:</p>
      <form id="resForm">
        <input type="hidden" id="resId" value="">
        <input type="text" id="resName" placeholder="Your name" style="width:100%; margin:6px 0; padding:10px; border:1px solid #ccc; border-radius:8px" />
        <input type="email" id="resEmail" placeholder="Your email" style="width:100%; margin:6px 0; padding:10px; border:1px solid #ccc; border-radius:8px" />
        <div style="display:flex; gap:10px; margin-top:12px; justify-content:flex-end;">
          <button type="button" class="btn btn-ghost" id="resCancel">Cancel</button>
          <button type="submit" class="btn btn-primary">Access</button>
        </div>
      </form>
    </div>
  </div>

  <script is:inline>
    const modal = document.getElementById('resModal');
    const resId = document.getElementById('resId');
    document.querySelectorAll('[data-open-download]').forEach(b=>{
      b.addEventListener('click', ()=>{ resId.value = b.dataset.openDownload; modal.style.display='flex'; });
    });
    document.getElementById('resCancel').onclick = ()=> modal.style.display='none';

    // Replace with your Formspree endpoint
    const FORMSPREE = 'https://formspree.io/f/yourFormId';

    document.getElementById('resForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const name  = document.getElementById('resName').value.trim();
      const email = document.getElementById('resEmail').value.trim();
      if (!email) { alert('Please enter a valid email'); return; }
      try{
        await fetch(FORMSPREE, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ name, email, resource: resId.value, source: location.href })
        });
      }catch(e){ console.warn('Form submit failed', e); }
      modal.style.display='none';
      // Immediately deliver resource (swap URLs as needed)
      const base = import.meta.env?.BASE_URL || '/';
      const map = {
        'whitepaper-ai':  (base || '/') + 'assets/sample-whitepaper-ai.pdf',
        'webinar-e8':     'https://example.com/your-webinar-url', // external okay
        'guide-soc2':     (base || '/') + 'assets/sample-soc2-guide.pdf'
      };
      const url = map[resId.value];
      if (url) window.open(url, '_blank');
    });
  </script>
</Base>
